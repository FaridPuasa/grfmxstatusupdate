<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Delivery</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css">
    <style>
        /* Custom CSS for your page */
        .navbar-nav.flex-row {
            flex-direction: row !important;
        }

        /* Make the navbar background transparent */
        .navbar {
            background-color: transparent;
        }

        /* Add background color to the container */
        .container-bg {
            background-color: #333;
            /* You can use your desired background color here */
        }

        /* Add margin to the navigation links */
        .navbar-nav.flex-row .nav-item {
            margin-right: 10px;
        }

        /* Add margin to the submit button */
        .btn-submit {
            margin-top: 10px;
            /* Adjust the margin-top as needed */
        }

        /* Increase the margin-bottom for the h1 element */
        h1 {
            margin-bottom: 20px;
            /* Adjust the value as needed */
        }
    </style>
</head>

<body>
    <div class="container-bg">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="navbar navbar-expand-lg navbar-dark">
                        <a class="navbar-brand mr-auto" href="/">
                            <h2>Go Rush</h2>
                        </a>
                        <ul class="navbar-nav flex-row">
                            <li class="nav-item"><a class="nav-link" href="/">Update Delivery</a></li>
                            <li class="nav-item"><a class="nav-link" href="/addressAreaCheck">Address Area Checker (FMX)</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <main class="container mt-4">
        <h1>Update Delivery</h1>
        <form action="/updateDelivery" method="post">
            <div class="mb-3">
                <label for="consignmentID" class="form-label">Tracking Number(s):</label>
                <textarea id="consignmentID" name="consignmentIDs" class="form-control" rows="2" required></textarea>
                <small>For old GRP orders, use Go Rush tracking number. For new GRP orders from 9.10.23 onwards, use
                    original tracking number</small>
            </div>
            <div class="mb-3">
                <label for="statusCode" class="form-label">Status Code:</label>
                <select id="statusCode" name="statusCode" class="form-select" required>
                    <option value="" selected>Please select status</option>
                    <option value="CP">Custom Clearance In Progress (FMX)</option>
                    <option value="38">Custom Clearance Release (FMX)</option>
                    <option value="12">Item In Warehouse</option>
                    <option value="35">Out for Delivery</option>
                    <option value="NA">Fail Delivery due to customer cannot be contacted (FMX)</option>
                    <option value="44">Return To Warehouse</option>
                    <option value="SC">Self Collect</option>
                    <option value="50">Success (FMX)</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="assignDate" class="form-label">Assign Date:</label>
                <input type="date" id="assignDate" name="assignDate" class="form-control" min="{{todayDate}}" disabled>
            </div>
            <div class="mb-3">
                <label for="dispatchers" class="form-label">Dispatchers:</label>
                <select id="dispatchers" name="dispatchers" class="form-select" disabled>
                    <option value="" selected>Please select dispatcher</option>
                    <option value="Hasbul">Hasbul</option>
                    <option value="Safwan">Safwan</option>
                    <option value="Hazri">Hazri</option>
                    <option value="Naizam">Naizam</option>
                    <option value="CS SC">CS SC</option>
                </select>
            </div>
            <button type="submit" id="submitButton" class="btn btn-primary">Submit</button>
        </form>

        <div id="loading" class="text-center" style="display: none;">
            <div class="spinner-border" role="status">
                <span class="sr-only">Loading...</span>
            </div>
            <p>Loading...</p>
        </div>
    </main>

    <script>
        // Get references to the "Assign Date" and "Dispatchers" fields
        const assignDateField = document.getElementById('assignDate');
        const dispatchersField = document.getElementById('dispatchers');

        // Get reference to the "Status Code" select element
        const statusCodeSelect = document.getElementById('statusCode');

        // Get reference to the submit button
        const submitButton = document.getElementById('submitButton');

        // Get the current date in YYYY-MM-DD format
        const todayDate = new Date().toISOString().split('T')[0];

        // Set the minimum date for the "Assign Date" field to today
        assignDateField.min = todayDate;

        // Function to disable the submit button when it's clicked and show the loading animation
        function disableSubmitButton(event) {
            submitButton.disabled = true;
            document.getElementById('loading').style.display = 'block'; // Show the loading animation
        }

        // Attach the disableSubmitButton function to the "submit" event of the form
        document.querySelector('form').addEventListener('submit', disableSubmitButton);

        // Function to enable/disable fields and set them as required based on the selected status code
        function updateFieldStatus() {
            const selectedStatusCode = statusCodeSelect.value;

            // Reset the values of "Assign Date" and "Dispatchers"
            assignDateField.value = '';
            dispatchersField.value = '';

            if (selectedStatusCode === '35') {
                // Enable the fields for "Out for Delivery" or "Self Collect"
                assignDateField.disabled = false;
                dispatchersField.disabled = false;

                // Set the fields as required
                assignDateField.required = true;
                dispatchersField.required = true;

                // Disable all options in the Dispatchers dropdown except "CS SC" if selected
                const dispatcherOptions = dispatchersField.options;
                for (let i = 0; i < dispatcherOptions.length; i++) {
                    const option = dispatcherOptions[i];
                    if (option.value === 'CS SC' && dispatchersField.value !== 'CS SC') {
                        option.disabled = true;
                    } else {
                        option.disabled = false;
                    }
                }
            } else if (selectedStatusCode === 'SC') {
                // Enable the fields for "Out for Delivery" or "Self Collect"
                assignDateField.disabled = false;
                dispatchersField.disabled = false;

                // Set the fields as required
                assignDateField.required = true;
                dispatchersField.required = true;

                // Select "CS SC" automatically when "Self Collect" is chosen
                if (selectedStatusCode === 'SC') {
                    dispatchersField.value = 'CS SC';
                }

                // Disable all options in the Dispatchers dropdown except "CS SC" if selected
                const dispatcherOptions = dispatchersField.options;
                for (let i = 0; i < dispatcherOptions.length; i++) {
                    const option = dispatcherOptions[i];
                    if (option.value === 'CS SC' && dispatchersField.value !== 'CS SC') {
                        option.disabled = false;
                    } else {
                        option.disabled = true;
                    }
                }
            } else {
                // Disable the fields for other status codes
                assignDateField.disabled = true;
                dispatchersField.disabled = true;

                // Remove the "required" attribute from the fields
                assignDateField.required = false;
                dispatchersField.required = false;

                // Enable all options in the Dispatchers dropdown
                const dispatcherOptions = dispatchersField.options;
                for (let i = 0; i < dispatcherOptions.length; i++) {
                    dispatcherOptions[i].disabled = false;
                }
            }
        }

        // Attach the updateFieldStatus function to the "change" event of the status code select element
        statusCodeSelect.addEventListener('change', updateFieldStatus);

        // Initialize field status based on the initial selected status code
        updateFieldStatus();
    </script>
</body>

</html>