<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runsheet</title>
    <!-- Add Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css">
    <!-- Add your custom CSS styles here -->
    <style>
        /* Add any custom styles specific to your runsheet here */
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
            /* Center-align horizontally */
            vertical-align: middle;
            /* Center-align vertically */
        }

        th {
            background-color: #6e9e9e;
            font-weight: bold;
            /* Add this to make labels bold */
        }

        /* Adjust the width and height of the logo */
        .logo-cell img {
            width: 150px;
            /* Adjust the width as needed */
            height: auto;
            /* Maintain aspect ratio */
        }

        /* Add borders to th elements in the first row, excluding the logo cell */
        tr:first-child th:not(.logo-th) {
            border-top: 1px solid black;
            border-bottom: 1px solid black;
        }

        /* Hide buttons when printing */
        @media print {

            #printButton,
            #exportPdfButton,
            #exportExcelButton {
                display: none;
            }
        }
    </style>
</head>

<body class="bg-light">
    <table>
        <tr>
            <!-- Logo cell without borders -->
            <td colspan="4" rowspan="2" class="logo-cell"><img src="/images/logo.png" alt="Logo"></td>
            <th>Product:</th> <!-- Use <th> for labels -->
            <td>
                <%= product %>
            </td>
            <th>POD Date Created:</th> <!-- Use <th> for labels -->
            <td colspan="4">
                <%= podCreatedDate %>
            </td>
            <th>Made By:</th> <!-- Use <th> for labels -->
            <td colspan="2">
                <%= podCreatedBy %>
            </td>
        </tr>
        <tr>
            <th>Delivery Date:</th> <!-- Use <th> for labels -->
            <td>
                <%= deliveryDate %>
            </td>
            <th>Area:</th> <!-- Use <th> for labels -->
            <td colspan="4">
                <%= areas %>
            </td>
            <th>Dispatcher:</th> <!-- Use <th> for labels -->
            <td colspan="2">
                <%= dispatchers %>
            </td>
        </tr>
        <tr>
            <th>No.</th>
            <th>Item with me</th>
            <th>Fridge</th>
            <th>Tracking No.</th>
            <th>Contact Name</th>
            <th>Contact Address</th>
            <th>Contact No.</th>
            <th>Delivery Type</th>
            <th>Price</th>
            <th>Payment Method</th>
            <th>Amount Collected</th>
            <th>Remarks</th>
            <th>Checked and Received By Finance</th>
            <th>Task Completed</th>
        </tr>
        <% trackingNumbers.forEach(function(item, index) { %>
            <tr>
                <td>
                    <%= index + 1 %>
                </td>
                <td></td>
                <td></td>
                <td>
                    <%= item.trackingNumber %>
                </td>
                <td>
                    <%= item.deliverToCollectFrom %>
                </td>
                <td>
                    <%= item.address %>
                </td>
                <td>
                    <%= item.phoneNumber %>
                </td>
                <td>
                    <%= item.jobType %>
                </td>
                <td>
                    <%= item.totalPrice %>
                </td>
                <td>
                    <%= item.paymentMode %>
                </td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <% }); %>
    </table>

    <!-- Add Bootstrap and custom scripts here -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
    <button id="printButton">Print</button>
    <button id="exportPdfButton">Export PDF</button>
    <button id="exportExcelButton">Export Excel</button>
    <script>
        document.getElementById('printButton').addEventListener('click', function () {
            window.print();
        });

        document.getElementById('exportPdfButton').addEventListener('click', function () {
            // Capture the table as an image using html2canvas
            html2canvas(document.querySelector('table')).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                pdf.addImage(imgData, 'PNG', 10, 10, 190, 0);
                pdf.save('table.pdf');
            });
        });

        document.getElementById("exportExcelButton").addEventListener("click", function () {
            // Get the dispatcher name and delivery date
            const dispatcherName = "<%= dispatchers.replace(/\\s+/g, "_").toUpperCase() %>";
            const deliveryDate = "<%= deliveryDate.replace(/\\./g, "") %>";

            // Create a new Excel workbook
            const wb = XLSX.utils.book_new();

            // Extract the table data
            const table = document.querySelector('table');
            const ws = XLSX.utils.table_to_sheet(table);

            // Add the worksheet to the workbook
            XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');

            // Generate a blob containing the Excel data
            const filename = `${dispatcherName} ${deliveryDate}.xlsx`;
            XLSX.writeFile(wb, filename);
        });
    </script>
</body>

</html>